<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JUALAN CEMILAN MAK E - Spesialis Pedas Nonjok</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ------------------------------------------------------------------ */
      /* --- 1. CSS STYLES LENGKAP (VERSI FINAL V8.0 - FIX KERANJANG DESKTOP & HEADER HP) --- */
      /* ------------------------------------------------------------------ */

      /* --- Global Styles & Layout Fix --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: #f8f8f8;
        color: #333;
        display: flex;
        flex-direction: column;
        padding-bottom: 90px;
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      .container {
        width: 90%;
        max-width: 1300px;
        margin: 0 auto;
        padding: 20px 0;
        flex-grow: 1;
        background-color: #f8f8f8;
      }

      /* --- Header Section (FIX V8.0) --- */
      .main-header {
        background-color: #c90000;
        color: white;
        padding: 0 20px;
        position: relative;
        overflow: hidden;
        min-height: 280px; /* Diperbesar sedikit agar tulisan HP lebih lega */
        display: flex;
        align-items: center;
      }

      /* Membuat background motif titik */
      .main-header::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle,
            rgba(255, 255, 255, 0.05) 1px,
            transparent 1px
          )
          no-repeat;
        background-size: 100px 100px;
        opacity: 0.1;
        z-index: 1;
      }

      /* FIX V8.0: Tata letak Grid Header diubah agar penulisan tidak tabrakan di HP */
      .header-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px; /* Jarak dikurangi */
        max-width: 1300px;
        width: 100%;
        margin: 0 auto;
        position: relative;
        z-index: 2;
        align-items: center;
        padding: 30px 0; /* Padding dikurangi sedikit */
        text-align: center;
      }

      .header-left {
        text-align: center;
      }
      .header-left .tagline {
        font-size: 1rem; /* Ukuran tagline dikecilkan */
        font-weight: 700;
      }
      .header-left h1 {
        font-size: 2.5rem; /* Ukuran H1 Dikecilkan untuk HP agar tidak terhimpit */
        font-weight: 900;
        margin: 0 0 0px 0;
        letter-spacing: 1px;
        line-height: 1.2;
      }
      .header-left .sub-tagline {
        font-size: 0.9rem; /* Ukuran sub-tagline dikecilkan */
        font-weight: 500;
        margin-bottom: 15px;
      }

      .btn-pesan-sekarang {
        display: inline-block;
        background-color: #ff9900;
        color: white;
        padding: 12px 30px;
        border-radius: 10px;
        margin-top: 20px;
        font-weight: 700;
        font-size: 1.1rem;
        transition: background-color 0.2s;
      }
      .btn-pesan-sekarang:hover {
        background-color: #e68a00;
      }

      /* Header kanan (Hanya muncul di Desktop) */
      .header-right {
        display: none;
      }

      .info-buka {
        font-weight: 600;
        font-size: 1.1rem;
        margin-top: 0;
      }

      .location-info {
        display: block;
        color: #ff9900;
        font-weight: 700;
        transition: color 0.2s;
        font-size: 1rem;
      }

      /* FIX V8.0: Tombol Pemicu Modal Keranjang di Desktop */
      .desktop-cart-trigger {
        background-color: #ff9900;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        margin-top: 15px;
        transition: background-color 0.2s;
        display: none; /* Default tersembunyi */
      }
      .desktop-cart-trigger:hover {
        background-color: #e68a00;
      }
      .cart-summary-desktop {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1.1rem;
        font-weight: 700;
      }

      /* --- ABOUT SECTION --- */
      .about-section {
        background-color: white;
        border-radius: 18px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin: 50px auto;
        max-width: 900px;
        text-align: center;
      }
      .about-section h2 {
        font-size: 2rem;
        font-weight: 900;
        color: #333;
        margin-bottom: 20px;
      }
      .about-section p {
        font-size: 1rem;
        line-height: 1.6;
        color: #555;
      }

      /* --- SEARCH BAR --- */
      .search-bar {
        display: flex;
        align-items: center;
        max-width: 900px;
        margin: 30px auto;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 10px 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      }
      .search-bar input {
        border: none;
        outline: none;
        padding: 5px 10px;
        font-size: 1rem;
        width: 100%;
      }
      .search-bar i {
        color: #ff9900;
        font-size: 1.2rem;
        margin-right: 10px;
      }

      /* --- Menu Tabs --- */
      .menu-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        overflow-x: auto;
        padding-bottom: 10px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .menu-tabs::-webkit-scrollbar {
        display: none;
      }

      .tab-button {
        flex-shrink: 0;
        background-color: #e0e0e0;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        transition: background-color 0.2s, color 0.2s;
        white-space: nowrap;
      }
      .tab-button.active {
        background-color: #ff9900;
        color: white;
      }
      .tab-button:hover {
        background-color: #ff9900;
        color: white;
      }

      /* --- Menu Grid & Card (FIX V8.0: Tetap 2 Kolom) --- */
      .category-title {
        font-size: 2rem;
        font-weight: 900;
        margin: 40px 0 20px 0;
        color: #c90000;
        border-bottom: 3px solid #ff9900;
        padding-bottom: 8px;
      }
      .menu-grid {
        display: grid;
        /* FIX V7.0/V8.0: Minimal lebar 300px, akan otomatis menjadi 2 kolom jika cukup */
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
      }
      .menu-card {
        background-color: white;
        border-radius: 18px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
        overflow: hidden;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 200px;
      }

      .price-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
      }

      .price {
        font-size: 1.8rem;
        font-weight: 900;
        color: #c90000;
      }

      .btn-tambah {
        background-color: #ff9900 !important;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.2s;
        min-width: 100px;
        box-shadow: 0 2px 5px rgba(255, 153, 0, 0.4);
      }
      .btn-tambah:hover {
        background-color: #e68a00 !important;
      }

      /* --- Footer --- */
      .main-footer {
        background-color: #444;
        color: #ddd;
        padding: 30px 20px 20px 20px;
        text-align: center;
        margin-top: auto;
      }

      .footer-info-wrapper {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 15px;
      }
      .footer-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
        font-weight: 600;
        color: #fff;
      }
      .footer-item i {
        color: #ff9900;
      }
      .instagram-row {
        margin-top: 10px;
        margin-bottom: 10px;
        font-size: 1rem;
        font-weight: 700;
      }
      .instagram-row i {
        color: #ff9900;
        margin-right: 5px;
      }
      .copyright {
        font-size: 0.8rem;
        color: #aaa;
        margin-top: 10px;
      }

      /* --- MODAL OVERLAY & BASE MODAL --- */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        overflow-y: auto;
      }

      .modal-overlay.active {
        display: flex;
      }

      .keranjang-modal,
      .level-modal {
        background-color: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;

        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1001;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #ff9900;
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      .modal-header h3 {
        color: #c90000;
        font-weight: 900;
        margin: 0;
      }
      .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: #aaa;
        cursor: pointer;
      }

      /* Item di Keranjang - Layout dan Tombol Dikecilkan */
      .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px dashed #eee;
        font-size: 1rem;
      }

      .cart-item:last-child {
        border-bottom: none;
      }

      .item-info {
        flex-grow: 1;
        padding-left: 10px;
      }

      .item-info p {
        margin: 0;
        font-weight: 700;
      }

      .item-price {
        color: #555;
        font-size: 0.9rem;
      }

      .item-controls {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .qty-button {
        background-color: #ff9900;
        color: white;
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 6px;
        font-weight: 900;
        cursor: pointer;
        transition: background-color 0.2s;
        padding: 0;
        line-height: 1;
        font-size: 0.9rem;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .qty-button i {
        font-size: 0.8rem;
      }

      .qty-button.remove {
        background-color: #c90000;
      }

      .qty-button:hover {
        opacity: 0.8;
      }

      .item-controls span {
        width: 20px;
        text-align: center;
        font-weight: 700;
        font-size: 0.9rem;
      }

      .delete-button {
        background: none;
        border: none;
        color: #c90000;
        cursor: pointer;
        font-size: 1.1rem;
        padding: 3px;
        margin-right: 3px;
        transition: color 0.2s;
      }
      .delete-button:hover {
        color: #ff0000;
      }

      .modal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 2px solid #ff9900;
      }

      .total-info span:first-child {
        font-weight: 600;
        font-size: 1.1rem;
      }

      .total-info span:last-child {
        font-weight: 900;
        font-size: 1.4rem;
        color: #c90000;
        margin-left: 10px;
      }

      .btn-pesan-wa {
        background-color: #25d366;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      /* --- FLOATING CART (HP) --- */
      .floating-cart {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #c90000;
        color: white;
        padding: 10px 20px;
        z-index: 999;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
      }
      .cart-summary {
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .btn-checkout {
        background-color: #ff9900;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .btn-checkout:hover {
        background-color: #e68a00;
      }

      /* --- NOTIFICATION (TOAST) --- */
      #notification {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #25d366;
        color: white;
        padding: 15px 30px;
        border-radius: 10px;
        z-index: 1005;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      #notification i {
        font-size: 1.2rem;
      }

      #notification.show {
        opacity: 1;
        visibility: visible;
      }

      /* MEDIA QUERY: TAMPILAN HP */
      @media (max-width: 768px) {
        /* Pastikan Floating Cart muncul di HP jika ada item */
        .floating-cart {
          /* display: flex diatur di JS */
        }
      }

      /* MEDIA QUERY: TAMPILAN DESKTOP (Fix Pemicu Keranjang) */
      @media (min-width: 769px) {
        /* FIX V8.0: Tampilkan Pemicu Keranjang di Desktop */
        .desktop-cart-trigger {
          display: flex;
          justify-content: center;
          align-items: center;
        }

        .header-grid {
          grid-template-columns: 2fr 1fr;
          text-align: left;
          padding: 50px 0;
        }

        .header-left h1 {
          font-size: 3rem; /* Di desktop, kembalikan ukuran H1 normal */
        }

        .header-right {
          display: flex;
          padding: 20px;
          border-left: 1px solid rgba(255, 255, 255, 0.3);
          flex-direction: column;
          align-items: flex-end;
          margin-left: 10px;
          gap: 15px; /* Tambah jarak antar elemen */
        }

        /* FIX V8.0: Menu Grid Tetap 2 kolom di desktop (max 1300px) */
        .menu-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        /* Atur agar notifikasi muncul sedikit di atas footer di desktop */
        #notification {
          bottom: 100px;
        }

        /* Sembunyikan floating cart HP di Desktop */
        .floating-cart {
          display: none !important;
        }
      }
    </style>
  </head>

  <body>
    <header class="main-header">
      <div class="header-grid">
        <div class="header-left">
          <p class="tagline">MAKS E'S SNACK</p>
          <h1>JUALAN CEMILAN MAK E</h1>
          <p class="sub-tagline">
            SPESIALIS PEDAS NONJOK | Nasi Cili & Cemilan Kekinian Jember
          </p>
          <a
            href="#"
            target="_blank"
            class="btn-pesan-sekarang"
            id="btn-pesan-header"
            >PESAN SEKARANG VIA WA</a
          >
        </div>
        <div class="header-right">
          <p class="info-buka">
            <i class="fas fa-clock"></i> <span id="info-buka-text"></span>
          </p>
          <a
            href="https://maps.app.goo.gl/h3VHfwDjSok6SsZd7"
            target="_blank"
            class="location-info"
          >
            <i class="fas fa-map-marker-alt"></i> Lihat Lokasi Toko
          </a>

          <div class="desktop-cart-trigger" id="desktop-cart-trigger">
            <span class="cart-summary-desktop">
              <i class="fas fa-shopping-cart"></i>
              <span id="desktop-item-count">0 Item</span> |
              <span id="desktop-cart-total">Rp0</span>
            </span>
          </div>

          <a
            href="#"
            target="_blank"
            class="btn-pesan-sekarang"
            style="padding: 10px 20px; font-size: 1rem; margin-top: 0px"
            id="btn-pesan-header-right"
            >ORDER CEPAT</a
          >
        </div>
      </div>
    </header>

    <div class="container">
      <div class="about-section">
        <h2>
          <i class="fas fa-fire-alt" style="color: #ff9900"></i> Tentang Jualan
          Cemilan Mak E <i class="fas fa-fire-alt" style="color: #ff9900"></i>
        </h2>
        <p>
          Kami adalah **Spesialis Cemilan Pedas Nonjok** dan **Nasi Cili
          Kekinian Jember**.
          <br />
          Jualan Cemilan Mak E adalah destinasi utama Anda untuk mencari cemilan
          dan makanan instan dengan sensasi pedas yang 'nonjok' di Jember. Kami
          adalah pusat cemilan kekinian dan makanan instan super pedas. Dibuat
          dengan bumbu dan racikan cabai khusus, dijamin bikin ketagihan!
        </p>
        <p>
          **Kami berkomitmen menyajikan hidangan pedas lezat dengan harga
          terjangkau.**
        </p>
      </div>

      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input
          type="text"
          id="menu-search"
          placeholder="Cari menu, misal: Usus Cikruh..."
        />
      </div>

      <nav class="menu-tabs">
        <button class="tab-button active" data-category="all">
          Semua Menu
        </button>
        <button class="tab-button" data-category="instan">
          Nasi Pedas Instan
        </button>
        <button class="tab-button" data-category="kering">
          Cemilan Kering Pedas
        </button>
        <button class="tab-button" data-category="seblak">
          Seblak Instan Kering
        </button>
        <button class="tab-button" data-category="manis">
          Cemilan Manis & Lainnya
        </button>
      </nav>

      <main class="menu-section" id="menu-section"></main>
    </div>

    <footer class="main-footer">
      <div class="footer-info-wrapper">
        <div class="footer-item">
          <i class="fas fa-clock"></i>
          <span>Senin - Sabtu (08.00 - 16.00)</span>
          <span class="info-tambahan">| Minggu Tutup</span>
        </div>

        <a
          href="https://maps.app.goo.gl/h3VHfwDjSok6SsZd7"
          target="_blank"
          class="footer-item"
        >
          <i class="fas fa-map-marker-alt"></i>
          <span>Jl. Tidar Gg. Delta, Jember</span>
        </a>

        <a
          href="https://wa.me/6281234594673"
          target="_blank"
          class="footer-item"
        >
          <i class="fab fa-whatsapp"></i>
          <span>WhatsApp: 0812-3459-4673</span>
        </a>
      </div>

      <div class="instagram-row">
        <i class="fab fa-instagram"></i>
        <a href="https://instagram.com/camilanmake_sari" target="_blank">
          <span>Instagram: @camilanmake_sari</span>
        </a>
      </div>

      <p class="copyright">
        © 2025 Jualan Cemilan Mak E. Spesialis Pedas Nonjok Jember.
      </p>
    </footer>

    <div class="floating-cart" id="floating-cart">
      <p class="cart-summary">
        <i class="fas fa-shopping-cart"></i>
        <span id="item-count">0 Item</span> |
        <span id="cart-total-footer">Rp0</span>
      </p>
      <button class="btn-checkout" id="btn-checkout" disabled>Checkout</button>
    </div>

    <div class="modal-overlay" id="keranjang-modal-overlay">
      <div class="keranjang-modal">
        <div class="modal-header">
          <h3>Keranjang Belanja</h3>
          <button class="close-btn" id="close-modal-btn">×</button>
        </div>
        <div id="keranjang-list"></div>
        <div class="modal-footer">
          <div class="total-info">
            <span>Total:</span>
            <span id="cart-total-modal">Rp0</span>
          </div>
          <button class="btn-pesan-wa" id="btn-pesan-wa" disabled>
            <i class="fab fa-whatsapp"></i> Pesan Sekarang
          </button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="level-modal-overlay" style="display: none">
      <div class="level-modal">
        <div class="modal-header" style="border-bottom: none; margin-bottom: 0">
          <h4 style="color: #c90000; font-weight: 800">Pilih Level Pedas</h4>
          <button class="close-btn" id="close-level-modal">×</button>
        </div>
        <p id="level-modal-item-name" style="margin-top: 5px">
          Untuk [Nama Produk]
        </p>
        <div class="level-options">
          <button
            class="btn-level level-1"
            data-level="1"
            data-desc="Level 1 (Biasa)"
          >
            Level 1 (Biasa)
          </button>
          <button class="btn-level" data-level="2" data-desc="Level 2 (Sedang)">
            Level 2 (Sedang)
          </button>
          <button
            class="btn-level level-3"
            data-level="3"
            data-desc="Level 3 (NONJOK!)"
          >
            Level 3 (NONJOK!)
          </button>
          <button
            class="btn-level"
            data-level="4"
            data-desc="Level 4 (Ekstra Pedas)"
          >
            Level 4 (Ekstra Pedas)
          </button>
          <button
            class="btn-level level-5"
            data-level="5"
            data-desc="Level 5 (GILA!)"
          >
            Level 5 (GILA!)
          </button>
        </div>
      </div>
    </div>

    <div id="notification">
      <i class="fas fa-check-circle"></i>
      <span id="notification-message"></span>
    </div>

    <script>
      /* ------------------------------------------------------------------ */
      /* --- 2. JAVASCRIPT LENGKAP (VERSI FINAL V8.0 - FIX KERANJANG DESKTOP) --- */
      /* ------------------------------------------------------------------ */

      // Data Menu:
      const menuData = [
        {
          id: "nasi_ayam",
          name: "Nasi Ayam Cili Super Hot",
          description:
            "Nasi putih + ayam goreng dengan sambal cili super pedas.",
          price: 15000,
          rating: "5.0 (60)",
          category: "instan",
        },
        {
          id: "nasi_usus",
          name: "Nasi Usus Cili Super Hot",
          description: "Nasi putih + usus pedas, bumbu cabe rawit nonjok!",
          price: 13000,
          rating: "4.8 (48)",
          category: "instan",
        },
        {
          id: "nasi_polos",
          name: "Nasi Cili Polos",
          description: "Nasi putih hangat dengan ekstra sambal cili Mak E.",
          price: 8000,
          rating: "4.9 (35)",
          category: "instan",
        },
        {
          id: "usus_cikruh",
          name: "Usus Cikruh",
          description:
            "Usus kering renyah bumbu cikruh (pedas gurih), kemasan besar.",
          price: 7000,
          rating: "4.9 (53)",
          category: "kering",
        },
        {
          id: "kaca_pedas",
          name: "Keripik Kaca Pedas",
          description: "Keripik kaca pedas gurih, renyah dan tipis.",
          price: 5000,
          rating: "4.7 (47)",
          category: "kering",
        },
        {
          id: "makaroni",
          name: "Makaroni Spiral",
          description: "Makaroni spiral kering dengan bumbu pedas ekstra.",
          price: 4000,
          rating: "4.2 (32)",
          category: "kering",
        },
        {
          id: "basreng_premium",
          name: "Basreng Premium",
          description: "Basreng kering premium pedas.",
          price: 7000,
          rating: "5.0 (6)",
          category: "kering",
        },
        {
          id: "seblak_ceker",
          name: "Seblak Ceker (Kering)",
          description: "Seblak kering instan siap seduh dengan topping ceker.",
          price: 6000,
          rating: "4.7 (41)",
          category: "seblak",
        },
        {
          id: "sus_coklat",
          name: "Sus Isi Coklat",
          description: "Kue sus mini dengan isian coklat lumer manis.",
          price: 6000,
          rating: "4.7 (41)",
          category: "manis",
        },
        {
          id: "cilok_aci",
          name: "Cilok Aci",
          description: "Cilok aci kenyal gurih.",
          price: 5000,
          rating: "4.4 (4)",
          category: "manis",
        },
      ];

      // Variabel Global
      let cart = {};
      let currentFilter = "all";
      let pendingItemId = null;
      const storeInfo = {
        open: "08:00",
        close: "16:00",
        days: [1, 2, 3, 4, 5, 6],
        whatsapp: "6281234594673",
      };

      // --- HELPER FUNCTIONS ---

      function formatRupiah(number) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0,
        }).format(number);
      }

      function showNotification(message) {
        const notification = document.getElementById("notification");
        const messageSpan = document.getElementById("notification-message");

        messageSpan.textContent = message;
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      function updateStoreStatus() {
        const now = new Date();
        const day = now.getDay();
        const hour = now.getHours();
        const minute = now.getMinutes();
        const currentTime = hour + minute / 60;
        const openTime = 8;
        const closeTime = 16;

        const infoBukaElement = document.getElementById("info-buka-text");

        let statusText;
        let isStoreOpen = false;

        if (
          storeInfo.days.includes(day) &&
          currentTime >= openTime &&
          currentTime < closeTime
        ) {
          statusText = `**BUKA** (Sampai ${storeInfo.close})`;
          isStoreOpen = true;
        } else if (day === 0) {
          statusText = `TUTUP (Hari Minggu)`;
        } else if (currentTime >= closeTime) {
          statusText = `TUTUP (Buka lagi besok jam ${storeInfo.open})`;
        } else if (currentTime < openTime) {
          statusText = `TUTUP (Buka jam ${storeInfo.open})`;
        } else {
          statusText = `TUTUP`;
        }

        if (isStoreOpen) {
          infoBukaElement.style.color = "#33cc33";
          infoBukaElement.style.fontWeight = "800";
        } else {
          infoBukaElement.style.color = "white";
          infoBukaElement.style.fontWeight = "700";
        }

        infoBukaElement.innerHTML = statusText;
      }

      // --- MENU RENDERING & FILTERING ---

      function renderMenu(menuItems, currentFilterCategory) {
        const menuSection = document.getElementById("menu-section");
        menuSection.innerHTML = "";

        const groupedMenu = menuItems.reduce((acc, item) => {
          const category = item.category;
          if (!acc[category]) {
            acc[category] = [];
          }
          acc[category].push(item);
          return acc;
        }, {});

        const categoryMap = {
          instan: { title: "Nasi Pedas Instan", icon: "fas fa-hotdog" },
          kering: { title: "Cemilan Kering Pedas", icon: "fas fa-pepper-hot" },
          seblak: { title: "Seblak Instan Kering", icon: "fas fa-fire-alt" },
          manis: {
            title: "Cemilan Manis & Lainnya",
            icon: "fas fa-cookie-bite",
          },
        };

        let menuCount = 0;

        for (const category in categoryMap) {
          const categoryInfo = categoryMap[category];
          const itemsInCategory = groupedMenu[category] || [];

          if (itemsInCategory.length === 0) {
            continue;
          }

          menuCount += itemsInCategory.length;

          const titleElement = document.createElement("h2");
          titleElement.className = "category-title";
          titleElement.id = `${category}-title`;
          titleElement.innerHTML = `<i class="${categoryInfo.icon}"></i> ${categoryInfo.title}`;
          menuSection.appendChild(titleElement);

          const gridElement = document.createElement("div");
          gridElement.className = "menu-grid";

          itemsInCategory.forEach((item) => {
            const card = document.createElement("div");
            card.className = "menu-card";
            card.innerHTML = `
                <div class="menu-info">
                  <h3>${item.name}</h3>
                  <div class="rating">
                    ${"★".repeat(Math.round(parseFloat(item.rating)))} (${
              item.rating.split(" ")[1]
            })
                  </div>
                  <p class="description">${item.description}</p>
                </div>
                <div class="price-row">
                  <span class="price">${formatRupiah(item.price)}</span>
                  <button class="btn-tambah" data-id="${item.id}">
                    <i class="fas fa-plus"></i> Tambah
                  </button>
                </div>
              `;
            gridElement.appendChild(card);
          });

          menuSection.appendChild(gridElement);
        }

        if (menuCount === 0) {
          menuSection.innerHTML =
            '<p style="text-align: center; color: #c90000; font-size: 1.5rem; margin-top: 50px;">Maaf, menu yang Anda cari tidak ditemukan.</p>';
        }

        menuSection.querySelectorAll(".btn-tambah").forEach((button) => {
          button.addEventListener("click", (e) =>
            addToCart(e.currentTarget.dataset.id)
          );
        });
      }

      function filterMenu() {
        const searchQuery = document
          .getElementById("menu-search")
          .value.toLowerCase();

        let filteredMenu = menuData.filter(
          (item) => currentFilter === "all" || item.category === currentFilter
        );

        if (searchQuery) {
          filteredMenu = filteredMenu.filter(
            (item) =>
              item.name.toLowerCase().includes(searchQuery) ||
              item.description.toLowerCase().includes(searchQuery)
          );
        }

        renderMenu(filteredMenu, currentFilter);

        if (currentFilter !== "all" || searchQuery) {
          document
            .getElementById("menu-section")
            .scrollIntoView({ behavior: "smooth" });
        }
      }

      // --- CART LOGIC ---

      function addToCart(itemId) {
        const item = menuData.find((m) => m.id === itemId);

        const cartItemId = itemId;

        if (cart[cartItemId]) {
          cart[cartItemId].qty++;
        } else {
          cart[cartItemId] = {
            ...item,
            id: cartItemId,
            originalId: itemId,
            modifier: "",
            qty: 1,
          };
        }
        updateCartUI(cartItemId, "tambah");
      }

      function changeQuantity(cartItemId, type) {
        if (!cart[cartItemId]) return;

        if (type === "add") {
          cart[cartItemId].qty++;
          updateCartUI(cartItemId, "add");
        } else if (type === "remove") {
          cart[cartItemId].qty--;
          if (cart[cartItemId].qty <= 0) {
            delete cart[cartItemId];
            updateCartUI(cartItemId, "remove");
          } else {
            updateCartUI(cartItemId, "remove");
          }
        }
      }

      function removeItem(cartItemId) {
        if (cart[cartItemId]) {
          delete cart[cartItemId];
          updateCartUI(cartItemId, "remove");
        }
      }

      function calculateCartTotals() {
        let totalItems = 0;
        let totalPrice = 0;

        for (const id in cart) {
          totalItems += cart[id].qty;
          totalPrice += cart[id].qty * cart[id].price;
        }

        return { totalItems, totalPrice };
      }

      function updateCartUI(itemId, action) {
        const { totalItems, totalPrice } = calculateCartTotals();
        const floatingCart = document.getElementById("floating-cart");
        const desktopItemCount = document.getElementById("desktop-item-count");
        const desktopCartTotal = document.getElementById("desktop-cart-total");

        // Floating Cart (HP)
        if (totalItems > 0 && window.innerWidth <= 768) {
          floatingCart.style.display = "flex";
        } else {
          floatingCart.style.display = "none";
        }

        document.getElementById(
          "item-count"
        ).textContent = `${totalItems} Item`;
        document.getElementById("cart-total-footer").textContent =
          formatRupiah(totalPrice);
        document.getElementById("btn-checkout").disabled = totalItems === 0;

        // Desktop Cart Trigger
        if (desktopItemCount && desktopCartTotal) {
          desktopItemCount.textContent = `${totalItems} Item`;
          desktopCartTotal.textContent = formatRupiah(totalPrice);
        }

        const isCartEmpty = totalItems === 0;
        document.getElementById("btn-pesan-wa").disabled = isCartEmpty;

        renderCartModal();

        if (action === "tambah" || action === "add") {
          const originalId = itemId;
          const itemName =
            menuData.find((m) => m.id === originalId)?.name || "Produk";
          showNotification(`${itemName} berhasil ditambahkan!`);
        }
      }

      function renderCartModal() {
        const listContainer = document.getElementById("keranjang-list");
        listContainer.innerHTML = "";

        const cartArray = Object.values(cart);

        if (cartArray.length === 0) {
          listContainer.innerHTML =
            '<p id="empty-cart-message" style="text-align:center; color:#777; padding: 20px 0;">Keranjang Anda masih kosong.</p>';
          document.getElementById("cart-total-modal").textContent =
            formatRupiah(0);
          return;
        }

        let totalModal = 0;

        cartArray.forEach((item) => {
          totalModal += item.price * item.qty;

          const itemElement = document.createElement("div");
          itemElement.className = "cart-item";

          itemElement.innerHTML = `
                <button class="delete-button" data-id="${
                  item.id
                }"><i class="fas fa-trash-alt"></i></button>
                <div class="item-info">
                  <p>${
                    item.name
                  } <span style="color:#c90000; font-weight: 600;">${
            item.modifier || ""
          }</span></p>
                  <span class="item-price">@${formatRupiah(item.price)}</span>
                </div>
                <div class="item-controls">
                  <button class="qty-button remove" data-id="${
                    item.id
                  }"><i class="fas fa-minus"></i></button>
                  <span>${item.qty}</span>
                  <button class="qty-button add" data-id="${
                    item.id
                  }"><i class="fas fa-plus"></i></button>
                </div>
              `;
          listContainer.appendChild(itemElement);
        });

        document.getElementById("cart-total-modal").textContent =
          formatRupiah(totalModal);

        // Tambahkan event listener setelah render
        listContainer.querySelectorAll(".qty-button.add").forEach((btn) => {
          btn.addEventListener("click", (e) =>
            changeQuantity(e.currentTarget.dataset.id, "add")
          );
        });
        listContainer.querySelectorAll(".qty-button.remove").forEach((btn) => {
          btn.addEventListener("click", (e) =>
            changeQuantity(e.currentTarget.dataset.id, "remove")
          );
        });
        listContainer.querySelectorAll(".delete-button").forEach((btn) => {
          btn.addEventListener("click", (e) =>
            removeItem(e.currentTarget.dataset.id)
          );
        });
      }

      function generateWhatsappMessage() {
        const { totalPrice } = calculateCartTotals();
        let message =
          "Halo Jualan Cemilan Mak E,\n\nSaya ingin memesan menu berikut:\n\n";

        const cartArray = Object.values(cart);
        cartArray.forEach((item, index) => {
          const itemNameWithModifier = `${item.name}${item.modifier}`;
          message += `${index + 1}. ${
            item.qty
          }x ${itemNameWithModifier} (${formatRupiah(
            item.price * item.qty
          )})\n`;
        });

        message += `\n*Total Belanja:* ${formatRupiah(totalPrice)}\n\n`;
        message +=
          "Mohon diproses, terima kasih.\n\n*NB: Mohon isi data diri dan info pengiriman Anda.*";

        return encodeURIComponent(message);
      }

      function openWhatsappLink() {
        if (calculateCartTotals().totalItems === 0) {
          showNotification("Keranjang masih kosong, tidak bisa checkout.");
          return false;
        }
        const message = generateWhatsappMessage();
        const whatsappUrl = `https://wa.me/${storeInfo.whatsapp}?text=${message}`;
        window.open(whatsappUrl, "_blank");
        return true;
      }

      // --- EVENT LISTENERS & INITIALIZATION ---

      function openCartModal() {
        document
          .getElementById("keranjang-modal-overlay")
          .classList.add("active");
        renderCartModal();
      }

      document.addEventListener("DOMContentLoaded", () => {
        updateStoreStatus();
        filterMenu();
        updateCartUI();

        // Memperbaiki tampilan Floating Cart saat resize (misal dari Desktop ke HP)
        window.addEventListener("resize", () => {
          updateCartUI();
        });

        // Event Listeners for Tabs and Search
        document.querySelectorAll(".tab-button").forEach((button) => {
          button.addEventListener("click", (e) => {
            document
              .querySelectorAll(".tab-button")
              .forEach((btn) => btn.classList.remove("active"));
            e.currentTarget.classList.add("active");
            currentFilter = e.currentTarget.dataset.category;
            filterMenu();
          });
        });
        document
          .getElementById("menu-search")
          .addEventListener("input", filterMenu);

        // Event Listeners for Modal Keranjang
        // HP Floating Cart
        document
          .getElementById("floating-cart")
          .addEventListener("click", openCartModal);

        // Desktop Cart Trigger (FIX V8.0)
        document
          .getElementById("desktop-cart-trigger")
          .addEventListener("click", openCartModal);

        document
          .getElementById("close-modal-btn")
          .addEventListener("click", () => {
            document
              .getElementById("keranjang-modal-overlay")
              .classList.remove("active");
          });

        document
          .getElementById("btn-checkout")
          .addEventListener("click", openCartModal);

        // Tombol WA di Header & Modal
        const waClick = (e) => {
          e.preventDefault();
          if (calculateCartTotals().totalItems > 0) {
            openWhatsappLink();
          } else {
            showNotification(
              "Keranjang masih kosong, silakan tambahkan menu dulu."
            );
            openCartModal(); // Buka modal jika kosong untuk memicu user mengisi
          }
        };

        document
          .getElementById("btn-pesan-header")
          .addEventListener("click", waClick);
        document
          .getElementById("btn-pesan-header-right")
          .addEventListener("click", waClick);
        document
          .getElementById("btn-pesan-wa")
          .addEventListener("click", openWhatsappLink);
      });
    </script>
  </body>
</html>
